---
---

<div id="toast-container" class="toast-container"></div>

<style>
  .toast-container {
    position: fixed;
    bottom: var(--spacing-xl);
    right: var(--spacing-xl);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    pointer-events: none;
  }

  :global(.toast) {
    pointer-events: auto;
    min-width: 300px;
    max-width: 450px;
    padding: var(--spacing-md) var(--spacing-lg);
    background: var(--color-surface);
    color: var(--color-text-primary);
    border-left: 4px solid var(--color-primary);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-xl);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
    transform: translateX(120%);
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s ease;
    opacity: 0;
  }

  :global(.toast.show) {
    transform: translateX(0);
    opacity: 1;
  }

  :global(.toast--success) {
    border-left-color: var(--color-success);
  }

  :global(.toast--error) {
    border-left-color: var(--color-error);
  }

  :global(.toast--info) {
    border-left-color: #3498db;
  }

  :global(.toast-icon) {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  :global(.toast--success .toast-icon) { color: var(--color-success); }
  :global(.toast--error .toast-icon) { color: var(--color-error); }
  :global(.toast--info .toast-icon) { color: #3498db; }

  :global(.toast-message) {
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    flex-grow: 1;
  }

  :global(.toast-close) {
    background: none;
    border: none;
    color: var(--color-text-muted);
    cursor: pointer;
    padding: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color var(--transition-fast);
  }

  :global(.toast-close:hover) {
    color: var(--color-text-primary);
  }

  @media (max-width: 576px) {
    .toast-container {
      bottom: var(--spacing-md);
      left: var(--spacing-md);
      right: var(--spacing-md);
    }
    :global(.toast) {
      min-width: unset;
      width: 100%;
    }
  }
</style>

<script>
  class ToastManager {
    private container: HTMLElement | null;

    constructor() {
      this.container = document.getElementById('toast-container');
      this.initEventListeners();
    }

    private initEventListeners() {
      window.addEventListener('show-toast', (event: any) => {
        const { message, type, duration } = event.detail;
        this.show(message, type, duration);
      });
    }

    show(message: string, type: 'success' | 'error' | 'info' = 'success', duration: number = 3000) {
      if (!this.container) return;

      const toast = document.createElement('div');
      toast.className = `toast toast--${type}`;
      
      let icon = '';
      if (type === 'success') {
        icon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
      } else if (type === 'error') {
        icon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>';
      } else {
        icon = '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>';
      }

      toast.innerHTML = `
        <div class="toast-icon">${icon}</div>
        <span class="toast-message">${message}</span>
        <button class="toast-close" aria-label="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      `;

      this.container.appendChild(toast);

      // Trigger reflow for animation
      toast.offsetHeight;
      toast.classList.add('show');

      const closeBtn = toast.querySelector('.toast-close');
      closeBtn?.addEventListener('click', () => this.hide(toast));

      setTimeout(() => {
        this.hide(toast);
      }, duration);
    }

    private hide(toast: HTMLElement) {
      toast.classList.remove('show');
      toast.addEventListener('transitionend', () => {
        if (toast.parentNode === this.container) {
          this.container?.removeChild(toast);
        }
      }, { once: true });
    }
  }

  // Initialize the manager
  if (typeof window !== 'undefined') {
    (window as any).toastManager = new ToastManager();
    
    // Global helper
    (window as any).showToast = (message: string, type: 'success' | 'error' | 'info' = 'success', duration: number = 3000) => {
      window.dispatchEvent(new CustomEvent('show-toast', {
        detail: { message, type, duration }
      }));
    };
  }
</script>
