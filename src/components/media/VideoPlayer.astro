---
interface Props {
  videoUrl?: string;
  title: string;
  poster?: string;
  quality?: string;
  lang?: string;
}

const { 
  videoUrl, 
  title, 
  poster = '/images/placeholder-backdrop.svg',
  quality = 'HD',
  lang = 'Vietsub'
} = Astro.props;
---

<div class="video-player">
  <div class="video-container" id="video-container">
    {videoUrl ? (
      <iframe 
        id="video-iframe"
        src={videoUrl}
        title={title}
        allowfullscreen
        frameborder="0"
      ></iframe>
    ) : (
      <div class="video-placeholder">
        <img src={poster} alt={title} />
        <div class="placeholder-overlay">
          <div class="placeholder-icon">
            <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="2" y="4" width="20" height="16" rx="2"/>
              <path d="M10 9l5 3-5 3V9z" fill="currentColor"/>
            </svg>
          </div>
          <p class="placeholder-text">Đang tải video...</p>
          <p class="placeholder-subtext">Vui lòng chọn server hoặc tập phim bên dưới</p>
        </div>
      </div>
    )}
  </div>
  
  <!-- Player Info Bar -->
  <div class="player-info">
    <div class="player-info__left">
      <span class="player-info__quality">{quality}</span>
      <span class="player-info__lang">{lang}</span>
    </div>
    <div class="player-info__right">
      <button class="player-btn" id="light-btn" aria-label="Tắt đèn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
        Tắt đèn
      </button>
      <button class="player-btn" id="expand-btn" aria-label="Mở rộng">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
        </svg>
        Mở rộng
      </button>
    </div>
  </div>
</div>

<style>
  .video-player {
    width: 100%;
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-xl);
  }

  .video-container {
    position: relative;
    width: 100%;
    height: 40vh;
    background: #000;
  }

  @media (min-width: 1024px) {
    .video-container {
      height: 70vh;
    }
  }

  .video-container iframe {
    width: 100%;
    height: 100%;
    border: none;
  }

  .video-container.expanded {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    height: 100vh;
    z-index: 9999;
    border-radius: 0;
  }

  /* Placeholder */
  .video-placeholder {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .video-placeholder img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: blur(8px) brightness(0.3);
  }

  .placeholder-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: var(--spacing-xl);
  }

  .placeholder-icon {
    width: 100px;
    height: 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.1);
    border: 2px dashed rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-xl);
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-lg);
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
  }

  .placeholder-text {
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    color: var(--color-text-primary);
    margin-bottom: var(--spacing-sm);
  }

  .placeholder-subtext {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }

  /* Player Info */
  .player-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-sm) var(--spacing-lg);
    background: var(--color-surface-hover);
    border-top: 1px solid var(--color-border);
  }

  .player-info__left,
  .player-info__right {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
  }

  .player-info__quality,
  .player-info__lang {
    font-size: var(--font-size-xs);
    padding: 4px 10px;
    background: var(--color-surface);
    border-radius: var(--radius-sm);
    color: var(--color-text-secondary);
  }

  .player-info__quality {
    background: var(--color-primary);
    color: var(--color-background);
    font-weight: var(--font-weight-semibold);
  }

  .player-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    font-size: var(--font-size-xs);
    color: var(--color-text-secondary);
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
  }

  .player-btn:hover {
    background: var(--color-surface);
    color: var(--color-text-primary);
  }

  .player-btn.active {
    background: var(--color-primary);
    color: var(--color-background);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .player-info {
      flex-direction: column;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm);
    }

    .player-info__left,
    .player-info__right {
      width: 100%;
      justify-content: center;
    }
  }
</style>

<script>
  // Expand functionality
  const expandBtn = document.getElementById('expand-btn');
  const videoContainer = document.getElementById('video-container');
  
  expandBtn?.addEventListener('click', () => {
    videoContainer?.classList.toggle('expanded');
    const isExpanded = videoContainer?.classList.contains('expanded');
    if (expandBtn) {
      expandBtn.innerHTML = isExpanded 
        ? `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 14h6m0 0v6m0-6L3 21M20 10h-6m0 0V4m0 6l7-7"/>
           </svg> Thu nhỏ`
        : `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
           </svg> Mở rộng`;
    }
  });

  // Light toggle (dim background)
  const lightBtn = document.getElementById('light-btn');
  let lightsOff = false;
  
  lightBtn?.addEventListener('click', () => {
    lightsOff = !lightsOff;
    document.body.style.backgroundColor = lightsOff ? '#000' : '';
    lightBtn.classList.toggle('active', lightsOff);
    if (lightBtn) {
      lightBtn.innerHTML = lightsOff
        ? `<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
           </svg> Bật đèn`
        : `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
           </svg> Tắt đèn`;
    }
  });

  // ESC to exit expanded mode
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && videoContainer?.classList.contains('expanded')) {
      videoContainer.classList.remove('expanded');
    }
  });
</script>
